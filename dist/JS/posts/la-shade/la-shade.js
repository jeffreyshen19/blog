import scroller from"/dist/JS/scrollytelling/scroller.js";const margin={top:50,right:30,bottom:70,left:55};let map,histogram,histogramData,width=document.getElementById("vis").offsetWidth-margin.left-margin.right-30,height=document.getElementById("vis").offsetHeight-margin.top-margin.bottom,currentHistogram=-1;var scrollVis=function(){function a(a){d3.select("#vis").selectAll("img").transition().duration(500).style("opacity","0"),d3.select("#"+a).transition().duration(500).style("opacity","1")}function b(a,b){currentHistogram=a,d3.select("#graph").transition().duration(500).style("opacity","1");var c=d3.scaleLinear().domain([0,50]).range([0,width]),d=histogram(histogramData[a]),e=d3.median(histogramData[a]),f=c(e),g=d3.scaleLinear().range([height,0]).domain([0,d3.max(d,function(a){return a.length})]);d3.select(".y.axis").transition().duration(1e3).call(d3.axisLeft(g)),d3.select(".y-axis-label").transition().duration(1e3).text("Percent of Census Tract Area Covered By Tree Canopy ("+["Low","Middle","Upper"][a]+" Income Tracts)"),!1==b?(d3.select("svg").select(".median-text").transition().duration(1e3).style("opacity","0"),d3.select("svg").select(".median-line").transition().duration(1e3).style("opacity","0"),d3.select("svg").select(".median-arrow").transition().duration(1e3).style("opacity","0")):(d3.select("svg").select(".median-text").transition().duration(1e3).style("opacity","1").attr("transform",`translate(${f}, ${-22})`).text(`Median (${d3.format(".2%")(e/100)})`),d3.select("svg").select(".median-line").transition().duration(1e3).style("opacity","1").attr("x1",f).attr("x2",f),d3.select("svg").select(".median-arrow").transition().duration(1e3).style("opacity","1").attr("points",`${f},-5 ${f-10},-15 ${f+10},-15`)),d3.select("svg").selectAll("rect").data(d).transition().duration(1e3).attr("x",1).attr("transform",function(a){return"translate("+c(a.x0)+","+g(a.length)+")"}).attr("width",function(a){return c(a.x1)-c(a.x0)}).attr("height",function(a){return height-g(a.length)})}/**
   * activate -
   *
   * @param index - index of the activated section
   */ // Which visualization we currently are on
var c=-1,d=0,e=[],f=[],g=function(a){a.each(function(a){h(a),i()})},h=function(a){histogramData=a.histogramData;// Add histogram
var b=d3.select("#graph").style("opacity","0").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),c=d3.scaleLinear().domain([0,50]).range([0,width]);// Add X Axis
b.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(d3.axisBottom(c).tickFormat(a=>a+"%")),b.append("text").attr("class","y-axis-label").attr("transform",`translate(${width/2},${height+40})`).style("text-anchor","middle").style("font-family","IBMPlexSans").style("font-size",16),histogram=d3.histogram().value(function(a){return a})// I need to give the vector of value
.domain(c.domain())// then the domain of the graphic
.thresholds(c.ticks(25));// then the numbers of bins
// And apply this function to data to get the bins
var d=histogram(a.histogramData[0]);// Add median
b.append("text").attr("class","median-text").style("text-anchor","middle").style("font-family","IBMPlexSans").style("font-size",14),b.append("polygon").attr("class","median-arrow").style("fill","#24252a"),b.append("line").attr("class","median-line").attr("y1",0).attr("y2",height).style("stroke","#24252a").style("stroke-width",1).style("stroke-dasharray","4"),b.append("g").attr("class","y axis"),b.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-height/2).attr("dy","1em").style("text-anchor","middle").style("font-family","IBMPlexSans").style("font-size",16).text("Number of Census Tracts"),b.selectAll("rect").data(d).enter().append("rect").style("fill","#4e54c8")},i=function(){e[0]=function(){a("img1")},f[0]=function(){},e[1]=function(){a("img1")},f[1]=function(){},e[2]=function(){a("img2")},f[2]=function(){},e[3]=function(){a("img2")},f[3]=function(){},e[4]=function(){a("img3"),d3.select("#graph").transition().duration(500).style("opacity","0"),currentHistogram=-1},f[4]=function(){},e[5]=function(){d3.select("#img3").transition().duration(500).style("opacity","0"),b(0,!1)},f[5]=function(){},e[6]=function(){b(0)},f[6]=function(){},e[7]=function(){b(1)},f[7]=function(){},e[8]=function(){b(2)},f[8]=function(){}};// return chart function
return g.activate=function(a){d=a;var b=0>d-c?-1:1,f=d3.range(c+b,d+b,b);f.forEach(function(a){e[a]()}),c=d},g.update=function(a,b){f[a](b)},g};// Load data, then display
d3.json("/data/la-shade/census-tracts-2012.geojson").then(function(a){// Process data
let b=[[],[],[]];// Store the tree canopy cover, broken down by the median income of census tracts (lower, middle, upper income)
return a.features.forEach(function(a){let c=parseFloat(a.properties["TREE-PCT"]),d=parseInt(a.properties["median-income"]);isNaN(c)||isNaN(d)||(42e3>=d?b[0].push(c):125e3>=d?b[1].push(c)://Middle income
b[2].push(c))}),{geojson:a,histogramData:b}}).then(function(a){var b=scrollVis();d3.select("#vis").datum(a).call(b);var c=scroller().container(d3.select("#scrolling-vis"));// Handle Resize
c(d3.selectAll(".step")),c.on("active",function(a){d3.selectAll(".step").classed("active",function(b,c){return c===a}).style("opacity",function(b,c){return c===a?1:.1}),b.activate(a)}),c.on("progress",function(a,c){b.update(a,c)}),d3.select(window).on("resize",function(){console.log("resizing"),width=document.getElementById("vis").offsetWidth-margin.left-margin.right-30;var a=d3.select("#graph").select("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),b=d3.scaleLinear().domain([0,50]).range([0,width]);if(a.select(".x.axis").call(d3.axisBottom(b).tickFormat(a=>a+"%")),a.select(".y-axis-label").attr("transform",`translate(${width/2},${height+40})`),histogram=d3.histogram().value(function(a){return a}).domain(b.domain()).thresholds(b.ticks(25)),-1!=currentHistogram){var c=histogram(histogramData[currentHistogram]),d=d3.median(histogramData[currentHistogram]),e=b(d),f=d3.scaleLinear().range([height,0]).domain([0,d3.max(c,function(a){return a.length})]);d3.select("svg").select(".median-text").attr("transform",`translate(${e}, ${-22})`),d3.select("svg").select(".median-line").attr("x1",e).attr("x2",e),d3.select("svg").select(".median-arrow").attr("points",`${e},-5 ${e-10},-15 ${e+10},-15`),d3.select("svg").selectAll("rect").attr("x",1).attr("transform",function(a){return"translate("+b(a.x0)+","+f(a.length)+")"}).attr("width",function(a){return b(a.x1)-b(a.x0)}).attr("height",function(a){return height-f(a.length)})}})}).catch(function(a){// handle error here
console.log(a)});