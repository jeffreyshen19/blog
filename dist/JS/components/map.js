var states={AL:"Alabama",AK:"Alaska",AS:"American Samoa",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District Of Columbia",FM:"Federated States Of Micronesia",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MH:"Marshall Islands",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",MP:"Northern Mariana Islands",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PW:"Palau",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};d3.selectAll(".map").each(function(){var a,b=d3.select(this).select(".tooltip");d3.csv(this.dataset.csv).then(c=>{// Process csv data into correct format
let e=Object.keys(c[0]).slice(1),f=c.map(function(a){return e.forEach(function(b){a[b]=parseFloat(a[b])}),a});// Get color scale        
var g=d3.extent(f,a=>a["total-cost"]),h=d3.scaleLinear().domain(g).interpolate(d3.interpolateHcl).range([d3.rgb("#e4f1fe"),d3.rgb("#3a539b"),d3.rgb("#24252a")]);// Display SVG
d3.svg("/data/police-militarization/us-map-w-territories.svg").then(c=>{var d=c.documentElement;d3.select(this).node().appendChild(d),d3.select(d).style("width","100%").style("height","100%").attr("viewBox","0 0 900 600").select(".state").selectAll("*").data(f,function(a){return a?a.state:this.id})// Join svg elements to their corresponding state data
.style("transition","0.1s").style("fill",function(a){return h(a["total-cost"])}).on("mouseover",function(c){// Change color on hover
// Add tooltip text
d3.select(this).style("fill",d3.rgb(d3.color(h(c["total-cost"])).brighter(.3))),a=`
                <h1>${states[c.state]}</h1>
                <
              `,b.classed("hidden",!1).html(a)}).on("mousemove",()=>{var a=d3.mouse(this.children[1]);b.style("left",a[0]-Math.round(b.node().offsetWidth/2)+"px").style("top",a[1]-Math.round(b.node().offsetHeight)-10+"px")}).on("mouseout",function(a){d3.select(this).style("fill",d3.rgb(h(a["total-cost"]))),b.classed("hidden",!0)})})})});