d3.selectAll(".map").each(function(){d3.select(this.firstChild);d3.csv(this.dataset.csv).then(a=>{// Process csv data into correct format
let b=Object.keys(a[0]).slice(1),c=a.map(function(a){return b.forEach(function(b){a[b]=parseFloat(a[b])}),a});// Get color scale from data
var d=d3.extent(c,a=>a["total-cost"]),e=d3.scaleLinear().domain(d).interpolate(d3.interpolateHcl).range([d3.rgb("#e4f1fe"),d3.rgb("#3a539b"),d3.rgb("#24252a")]);// Display SVG
d3.svg("/data/police-militarization/us-map-w-territories.svg").then(a=>{console.log(a.documentElement);var b=a.documentElement;d3.select(this).node().appendChild(b),d3.select(b).select(".state").selectAll("*").data(c,function(a){return a?a.state:this.id})// Join svg elements to their corresponding state dataa
.style("fill",function(a){return e(a["total-cost"])}).on("mouseover",function(a){console.log(a)})})})});